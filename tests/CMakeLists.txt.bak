cmake_minimum_required(VERSION 3.26)
project(BeaconTests LANGUAGES CXX)

set(CMAKE_CXX_STANDARD 20)
set(CMAKE_CXX_STANDARD_REQUIRED ON)

# -----------------------------------------------------------------------------
# GoogleTest
# -----------------------------------------------------------------------------
# Adjust path to vendor/googletest relative to tests/
add_subdirectory(${CMAKE_SOURCE_DIR}/../vendor/googletest googletest_build)

# -----------------------------------------------------------------------------
# Include project headers
# -----------------------------------------------------------------------------
include_directories(${CMAKE_SOURCE_DIR}/../include)

# -----------------------------------------------------------------------------
# Gather all test executables
# -----------------------------------------------------------------------------
file(GLOB_RECURSE TEST_SOURCES "${CMAKE_SOURCE_DIR}/test_*/*.cpp")

foreach(TEST_SRC ${TEST_SOURCES})
    # Extract folder name as executable name
    get_filename_component(TEST_DIR ${TEST_SRC} DIRECTORY)
    get_filename_component(TEST_NAME ${TEST_DIR} NAME)

    add_executable(${TEST_NAME} ${TEST_SRC})
    target_link_libraries(${TEST_NAME} PRIVATE gtest gtest_main)

    # Register with CTest
    enable_testing()
    add_test(NAME ${TEST_NAME} COMMAND ${TEST_NAME})
endforeach()
